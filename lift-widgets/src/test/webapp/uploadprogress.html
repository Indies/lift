<lift:surround with="default" at="content">
  <head>
    <!-- <lift:UploadExample.script formId="#upload" /> -->
    <script type="text/javascript" src="/classpath/uploadprogress/jquery.timers-1.1.2.js"></script>
    <script type="text/javascript">
      // <![CDATA[
      $(function(){
        $("form").bind("submit", function(e){
          $(this).everyTime(1000, "hide", function() {
            $.ajax({
              type: "GET",
              async: true,
              url:"/progress?" + new Date().getTime(),
              dataType: "json",
              success: function(upload){
                var bar = $.browser.safari ? $('#progressbar', parent.document) : $('#progressbar');
                bar.css({width: Math.floor(upload.percentage)+'%'});
                if (upload.state == 'uploading') {
                  $('#percents').text(upload.percentage);
                } else if(upload.state == 'completed'){
                  $('#percents').text('Finishing...');
                  $("form").stopTime("hide");
                }
              }
            });
          },0,true);
        });
      });
      // ]]>
    </script>
    
    <style type="text/css">
    .bar {
      width: 300px;
    }

    #progress {
      background: #eee;
      border: 1px solid #222;
      margin-top: 20px;
    }
    #progressbar {
      width: 0px;
      height: 24px;
      background: #333;
    }
    </style>
  </head>
  
  <h2>Upload</h2>
  <p>Choose a file to upload</p>
  
  <lift:UploadExample.upload form="post" multipart="true" id="upload">
    <choose:post>
      <p>
        File name: <ul:file_name/><br />
        MIME Type: <ul:mime_type/><br />
        File length: <ul:length/><br />
        MD5 Hash: <ul:md5/><br />
      </p>
    </choose:post>
    
    <choose:get>
      <ul:file_upload/>
      <input type="submit" value="Upload"/>
      
      <div id="uploading">
        <div id="progress" class="bar">
          <div id="progressbar">&nbsp;</div>
          <div id="percents"></div>
        </div>
      </div>
      
      
    </choose:get>
    
  </lift:UploadExample.upload> 
  
  
   
</lift:surround>
